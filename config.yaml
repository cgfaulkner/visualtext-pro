alt_text_handling:
  mode: preserve
  fallback_policy: none    # none | doc-only | ppt-gated
  max_workers: 4
  reuse_for_identical_images: true
  clean_generated_alt_text: true
  detect_concepts_from_notes: true
  concepts_file: concepts.yaml
  concept_injection_style: prompt_block
  vague_output_warning: true
paths:
  input_folder: Slides to Review
  output_folder: Reviewed Reports
  thumbnail_folder: Slide Thumbnails
  temp_folder: Temp
  alt_cache: alt_cache.json
conversion:
  wmf_to_png: true
tools:
  inkscape: inkscape
prompts:
  default: Describe this image in one sentence (up to 125 characters). Focus on essential
    visual content.
  anatomical: Describe this anatomical image in one sentence (up to 125 characters).
    Mention key structures and orientations.
  diagnostic: Describe this diagnostic image in one sentence (up to 125 characters).
    Note the imaging type and key findings.
  chart: Describe this chart or graph in one sentence (up to 125 characters). Include
    axes, trends, or notable values.
  diagram: Describe this diagram in one sentence (up to 125 characters). Highlight
    main components and relationships.
  clinical_photo: Describe this clinical photo in one sentence (up to 125 characters).
    Focus on the visible condition or procedure.
  unified_medical: Describe this medical image in one sentence (up to 125 characters).
    Provide essential educational information.
decorative_overrides:
  decorative_rules:
    contains:
    - logo
    - watermark
    - border
    - divider
    - separator
    - footer
    - header
    - bg
    - line
    - accent
    exact:
    - utsw_logo.png
    - utsw_logo.jpg
    - UTSW logo.jpg
    - UTSW logo.png
    - utsw.jpg
    - utsw.png
    - logo_header.jpg
    - logo_footer.jpg
    - curve_line.svg
  force_decorative:
  - logo
  - watermark
  - border
  - divider
  - separator
  force_decorative_scope: shape_name
  never_decorative:
  - anatomy
  - pathology
  - xray
  - mri
  - ct
  - microscopy
  - diagram
  - chart
  - graph
output:
  char_limit: 125            # NEW: single source of truth
  thumbnail_max_width: 200
  include_token_count: true
  include_generation_time: true
  truncate_at_tokens: true
  smart_truncate: true
  smart_truncate_prompt: >
    Rewrite the following as one complete sentence of at most 125 characters,
    ending with a period:
  max_summary_words: 30      # not critical anymore, kept as guardrail
logging:
  level: INFO
  show_prompts: false
  show_responses: false
  log_to_file: true
  # Enhanced logging categories
  log_system_state: true
  log_configuration: true
  log_performance: true
  log_request_details: true
  log_pre_flight: true
reinjection:
  skip_alt_text_if:
  - ''
  - undefined
  - (None)
  - N/A
  - Not reviewed
  - n/a
ai_providers:
  fallback_chain:
  - llava
  providers:
    llava:
      type: llava
      model: llava
      base_url: http://127.0.0.1:11434
      endpoint: /api/generate
      timeout: 120
      max_tokens: 200
      temperature: 0.7
      stream: false
      retry_attempts: 5
      include_slide_notes: true
      include_slide_text: true
cost_tracking:
  enabled: true
  log_token_usage: true
  estimate_costs: true
  daily_budget_alert: 10.0
  monthly_budget_alert: 100.0
provider_settings:
  max_fallback_attempts: 3
  fail_fast: false
  comparison_mode: false
  save_provider_performance: true
pre_flight:
  enabled: true
  timeout: 30
  sample_image_path: null  # Will use built-in test image if null
  test_prompt: "Describe this test image in one sentence."
  fail_fast_on_error: true
  performance_baseline_threshold: 10.0  # seconds

# PDF Processing Configuration
pdf_processing:
  # Use ReportLab recreation workflow for better accessibility (recommended)
  use_recreation_workflow: false  # Set to true to enable ReportLab recreation
  
  # Decorative image detection settings
  skip_decorative_images: true
  decorative_size_threshold: 50  # Images smaller than this (px) are considered decorative
  
  # Recreation workflow specific settings
  recreation:
    preserve_fonts: true
    preserve_layout: true  
    max_image_width: 400  # Max width for images in recreated PDF (px)
    accessibility_standard: "PDF/UA"  # Target accessibility standard

# PPTX Processing Configuration (NEW)
pptx_processing:
  # Decorative image detection settings (same as PDF)
  skip_decorative_images: true
  decorative_size_threshold: 50  # Images smaller than this (px) are considered decorative
  
  # Context extraction settings
  include_slide_notes: true    # Include slide notes in ALT text generation context
  include_slide_text: true     # Include slide text in ALT text generation context
  max_context_length: 200      # Maximum length of context text to include
  
  # Batch processing settings
  max_workers: 4               # Number of concurrent slides to process
  preserve_original: true      # Keep backup of original file
  
  # Image extraction settings
  supported_formats: ["jpg", "jpeg", "png", "gif", "bmp", "tiff", "svg", "wmf", "emf"]
  convert_wmf_to_png: true     # Convert WMF files to PNG for better AI processing
  
  # Semantic analysis settings
  enable_semantic_icon_labels: false  # Disable to avoid false positives like "lungs icon"

approval_docs:
  include_context: true
  review_suffix: "_ALT_Review"
  image_max_width_px: 600

# Artifact Management Configuration
artifact_management:
  auto_cleanup: true              # Automatically cleanup artifacts after processing
  keep_finals: true               # Keep final_alt_map.json and visual_index.json
  max_age_days: 7                 # Maximum age before auto-cleanup (days)
  cleanup_on_success: true        # Cleanup temporary artifacts on successful processing
  cleanup_on_failure: false       # Keep artifacts on failure for debugging
  warn_threshold_gb: 5.0          # Warn if total artifact disk usage exceeds this (GB)

# File Locking Configuration
file_locking:
  enabled: true                   # Enable file locking to prevent concurrent access
  timeout_seconds: 30             # Maximum time to wait for lock acquisition
  retry_attempts: 3               # Number of retry attempts if lock acquisition fails
  retry_delay_seconds: 2          # Delay between retry attempts
  cleanup_stale_locks: true       # Automatically cleanup stale locks on startup
  stale_threshold_hours: 1        # Age threshold for considering locks stale (hours)

# Batch Processing Configuration
batch_processing:
  default_max_workers: 1          # Sequential processing by default (safe for Phase 2B.1)
  max_lock_wait_seconds: 30       # Maximum time to wait for file locks during batch
  manifest_retention_days: 30     # Keep batch manifests for resume capability (days)
  progress_update_interval: 5     # Print progress update every N files
  stop_on_error_threshold: 0.5    # Stop batch if failure rate exceeds this (0.0-1.0, 0.5 = 50%)
  dry_run_validates_ollama: true  # Check LLaVA connectivity during dry-run
  file_timeout_seconds: 300        # Timeout for individual file processing (seconds)

  # Output configuration
  complete_folder_name: "Complete"           # Folder name at project root
  output_timestamp_format: "%Y%m%d_%H%M%S"  # Timestamp format for folders
  preserve_folder_structure: true            # Keep nested folders in output

# --- Profiles ---
profiles:
  scientific_strict:
    # Keep context on for science-y slides; preserve existing write-path toggles
    pptx_processing:
      include_slide_notes: true
      include_slide_text: true
      convert_wmf_to_png: true
      max_workers: 4

  default:
    # Mirrors your current defaults so --profile default is explicit
    pptx_processing:
      include_slide_notes: true
      include_slide_text: true
      convert_wmf_to_png: true
      max_workers: 4

  fast_batch:
    # Faster pass: no context, more workers
    pptx_processing:
      include_slide_notes: false
      include_slide_text: false
      convert_wmf_to_png: true
      max_workers: 8
